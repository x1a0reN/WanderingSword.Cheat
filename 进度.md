# 逸剑风云决 (Wandering Sword) V1.24.32 作弊器开发进度

## 项目概述

- **目标**: 为逸剑风云决构建内置作弊/修改器
- **技术方案**: C++ DLL 注入 (version.dll 代理劫持) + Unreal Engine 4 SDK
- **SDK来源**: Dumper-7 生成的 UE4 SDK
- **UI方案**: 劫持游戏内置设置面板 `BPMV_ConfigView2_C` 作为作弊菜单基础
- **热键**: HOME 键切换显示/隐藏，DELETE 键卸载 DLL

## 最新进展（按钮稳定方案）

- **现象与结论**:
  - `UBP_JHConfigTabBtn_C` 直接创建或错误上下文复用时，悬停/点击容易触发空指针崩溃。
  - 当前稳定方案是走 `UJHCommon_Btn_Free_C`，并统一经过“标准初始化流程”，保证可见、可交互、可播放悬停动画。
- **当前稳定展示位置**:
  - 临时放在 **Tab1**（`kTempMoveControlsShowcaseToTab1 = true`），用于绕开 Tab8 当前崩溃路径。
- **工程化封装**:
  - 新增统一按钮工厂函数：`CreateGameStyleButton(...)`（文件：`Inject/Main.cpp`）。
  - 规则：优先复用可用实例；不可用则 `UWidgetBlueprintLibrary::Create` 新建；两条路径都执行同一套状态初始化（Visibility/Enable/Render/GotoNormalStatus/JHGPCBtn状态）。
  - 后续所有“游戏风格按钮”创建都应复用这条路径，避免再次出现“只显示文字/无动画/悬停崩溃”的分叉行为。
- **本次回退**:
  - 按需求恢复 `Btn_Revert2` 为“隐藏/移除”策略，不再保留可见测试态。
  - `ApplyConfigView2TextPatch` 中已回退为 `CV->Btn_Revert2->RemoveFromParent();`

## 架构设计

### 注入流程
1. `DllMain` → `CreateThread(MainThread)`
2. `MainThread`: 分配控制台 → Hook GVC PostRender VTable → 热键循环
3. `HookedGVCPostRender`: 每帧执行，处理 HOME 键切换、BTN_Exit 点击检测、外部关闭检测

### 核心 Hook
- **GVC PostRender Hook**: VTable Hook `UGameViewportClient::PostRender`
  - 索引由 `Offsets::GVCPostRenderIdx` 提供
  - 用于每帧逻辑（热键检测、UI 状态同步）

### 面板生命周期
```
HOME按下 → ToggleInternalWidget()
  ├─ 显示: CreateInternalWidgetInstance() → AddToViewport → InitializeConfigView2BySDK → ApplyConfigView2TextPatch → SetGamePaused(true)
  └─ 隐藏: RemoveFromParent() → SetGamePaused(false) → 清理缓存
```

## Tab 布局与功能规划

### Tab-Slot 映射关系
| Tab索引 | 按钮成员 | NamedSlot | 标签名 |
|---------|----------|-----------|--------|
| 0 | BTN_Sound | VolumeSlot | 角色 |
| 1 | BTN_Video | VideoSlot | 物品 |
| 2 | BTN_Keys | InputSlot | 战斗 |
| 3 | BTN_Lan | LanSlot | 生活 |
| 4 | BTN_Others | OthersSlot | 社交 |
| 5 | BTN_Gamepad | GamepadSlot | 系统 |
| 6* | 动态新增 | — | 队友 |
| 7* | 动态新增 | — | 任务 |

> **控件类型说明**:
> - **下拉框** = `UBPVE_JHConfigVideoItem2_C` (CB_Main ComboBox + TXT_Title)
> - **滑块** = `UBPVE_JHConfigVolumeItem2_C` (VolumeSlider + BTN_Minus/Plus + TXT_CurrentValue)
> - **开关** = 下拉框，选项为 "关 / 开" (SDK 中无 CheckBox 控件)

---

#### Tab 0 - 角色 (VolumeSlot)

| # | 功能 | 控件类型 | UI状态 | 说明 |
|---|------|----------|--------|------|
| 1 | 金钱 | 滑块 | ✅ 已创建 | |
| 2 | 武学点 | 滑块 | ✅ 已创建 | |
| 3 | 经脉点 | 滑块 | ✅ 已创建 | |
| 4 | 门派贡献 | 滑块 | ✅ 已创建 | |
| 5 | 继承点 | 滑块 | ✅ 已创建 | |
| 6 | 等级 | 滑块 | ✅ 已创建 | |
| 7 | 额外心法栏 | 下拉框 | ✅ 已创建 | 选项: 0/1/2 |
| 8 | 钓鱼等级 | 滑块 | ✅ 已创建 | |
| 9 | 门派 | 下拉框 | ✅ 已创建 | 选项: 无门派/少林/武当/峨眉/明教/丐帮/唐门/天山 |
| — | *属性* | | | |
| 10 | 气血 | 滑块 | ✅ 已创建 | |
| 11 | 气血上限 | 滑块 | ✅ 已创建 | |
| 12 | 真气 | 滑块 | ✅ 已创建 | |
| 13 | 真气上限 | 滑块 | ✅ 已创建 | |
| 14 | 精力 | 滑块 | ✅ 已创建 | |
| 15 | 精力上限 | 滑块 | ✅ 已创建 | |
| 16 | 力道 | 滑块 | ✅ 已创建 | |
| 17 | 根骨 | 滑块 | ✅ 已创建 | |
| 18 | 身法 | 滑块 | ✅ 已创建 | |
| 19 | 内功 | 滑块 | ✅ 已创建 | |
| 20 | 攻击 | 滑块 | ✅ 已创建 | |
| 21 | 防御 | 滑块 | ✅ 已创建 | |
| 22 | 暴击 | 滑块 | ✅ 已创建 | |
| 23 | 暴击抵抗 | 滑块 | ❌ 缺失 | 进度规划有但代码遗漏 |
| 24 | 闪避 | 滑块 | ✅ 已创建 | |
| 25 | 命中 | 滑块 | ✅ 已创建 | |
| 26 | 移动 | 滑块 | ❌ 未规划 | CT有，战斗格子移动力 |
| 27 | 集气速率 | 滑块 | ❌ 未规划 | CT有 |
| 28 | 气血/真气恢复速率 | 滑块×4 | ❌ 未规划 | CT有，4个恢复/回复速率 |
| 29 | 真气护盾 | 滑块 | ❌ 未规划 | CT有 |
| 30 | 名声 | 滑块 | ❌ 未规划 | CT有 |
| 31 | 气血护盾 | 滑块 | ❌ 未规划 | CT有 |
| 32 | 暴击伤害百分率 | 滑块 | ❌ 未规划 | CT有 |
| 33 | 金钱倍率 | 滑块 | ❌ 未规划 | CT有 |
| 34 | 武学点倍率 | 滑块 | ❌ 未规划 | CT有 |
| 35 | 真气消耗倍率 | 滑块 | ❌ 未规划 | CT有，可考虑放战斗Tab |
| — | *武器精通* | | | |
| 36 | 拳掌精通 | 滑块 | ✅ 已创建 | |
| 37 | 拳掌经验 | 滑块 | ❌ 缺失 | 进度规划有但代码只做了精通 |
| 38 | 剑法精通 | 滑块 | ✅ 已创建 | |
| 39 | 剑法经验 | 滑块 | ❌ 缺失 | 同上 |
| 40 | 刀法精通 | 滑块 | ✅ 已创建 | |
| 41 | 刀法经验 | 滑块 | ❌ 缺失 | 同上 |
| 42 | 枪棍精通 | 滑块 | ✅ 已创建 | |
| 43 | 枪棍经验 | 滑块 | ❌ 缺失 | 同上 |
| 44 | 暗器精通 | 滑块 | ✅ 已创建 | |
| 45 | 暗器经验 | 滑块 | ❌ 缺失 | 同上 |
| 46 | 其他武器精通 | 滑块 | ❌ 缺失 | 进度规划有但代码遗漏 |
| 47 | 其他武器经验 | 滑块 | ❌ 缺失 | 同上 |

---

#### Tab 1 - 物品 (VideoSlot)

| # | 功能 | 控件类型 | UI状态 | 说明 |
|---|------|----------|--------|------|
| 1 | 物品不减 | 开关 | ✅ 已创建 | |
| 2 | 物品获得加倍 | 开关 | ✅ 已创建 | |
| 3 | 　└ 加倍倍数 | 滑块 | ✅ 已创建 | |
| 4 | 所有物品可出售 | 开关 | ✅ 已创建 | |
| 5 | 　└ 包括任务物品 | 开关 | ✅ 已创建 | |
| 6 | 掉落率100% | 开关 | ✅ 已创建 | |
| 7 | 锻造制衣效果加倍 | 开关 | ✅ 已创建 | |
| 8 | 　└ 道具增量效果倍率 | 滑块 | ✅ 已创建 | |
| 9 | 　└ 额外效果倍率 | 滑块 | ✅ 已创建 | |
| 10 | 最大额外词条数 | 开关 | ✅ 已创建 | |
| 11 | 无视物品使用次数 | 开关 | ✅ 已创建 | |
| 12 | 无视物品使用要求 | 开关 | ✅ 已创建 | |
| — | *物品浏览器* | | ✅ 已创建 | 分类下拉框 + 翻页 + 24格图标网格 + 数量输入框 |

> 数据源: `UItemResManager::ItemDataTable` RowMap → FItemInfoSetting
> 图标: `UImage::SetBrushFromSoftTexture` (ProcessEvent raw bytes)
> 添加: `UItemFuncLib::AddItem(DefId, Num)` via CDO ProcessEvent

---

#### Tab 2 - 战斗 (InputSlot)

| # | 功能 | 控件类型 | UI状态 | 说明 |
|---|------|----------|--------|------|
| 1 | 伤害加倍 | 开关 | ✅ 已创建 | |
| 2 | 　└ 伤害倍率 | 滑块 | ✅ 已创建 | |
| 3 | 招式无视冷却 | 开关 | ✅ 已创建 | |
| 4 | 战斗加速 | 开关 | ✅ 已创建 | |
| 5 | 　└ 战斗加速倍数 | 滑块 | ✅ 已创建 | |
| 6 | 不遇敌 | 开关 | ✅ 已创建 | |
| 7 | 全队友参战 | 开关 | ✅ 已创建 | |
| 8 | 战败视为胜利 | 开关 | ✅ 已创建 | |
| 9 | 心法填装最后一格 | 开关 | ✅ 已创建 | |
| 10 | 战斗前自动恢复 | 开关 | ✅ 已创建 | |
| 11 | 移动速度加倍 | 开关 | ✅ 已创建 | |
| 12 | 　└ 移动倍率 | 滑块 | ✅ 已创建 | |
| 13 | 　└ 只对本方生效 | 开关 | ✅ 已创建 | |
| 14 | 逃跑成功率 | 滑块 | ❌ 未规划 | CT有 |

---

#### Tab 3 - 生活 (LanSlot)

| # | 功能 | 控件类型 | UI状态 | 说明 |
|---|------|----------|--------|------|
| 1 | 锻造/制衣/炼丹/烹饪无视要求 | 开关 | ✅ 已创建 | |
| 2 | 　└ 设置产出数量 | 开关 | ✅ 已创建 | |
| 3 | 　└ 产出数量 | 滑块 | ✅ 已创建 | |
| 4 | 采集一秒冷却 | 开关 | ✅ 已创建 | |
| 5 | 钓鱼只钓稀有物 | 开关 | ✅ 已创建 | |
| 6 | 钓鱼收杆必有收获 | 开关 | ✅ 已创建 | |
| 7 | 家园随时收获 | 开关 | ✅ 已创建 | |
| — | *生活精通* | | | |
| 8 | 锻造精通 | 滑块 | ❌ 缺失 | 进度规划有但代码未实现 |
| 9 | 锻造经验 | 滑块 | ❌ 缺失 | 同上 |
| 10 | 医术精通 | 滑块 | ❌ 缺失 | 同上 |
| 11 | 医术经验 | 滑块 | ❌ 缺失 | 同上 |
| 12 | 制衣精通 | 滑块 | ❌ 缺失 | 同上 |
| 13 | 制衣经验 | 滑块 | ❌ 缺失 | 同上 |
| 14 | 炼丹精通 | 滑块 | ❌ 缺失 | 同上 |
| 15 | 炼丹经验 | 滑块 | ❌ 缺失 | 同上 |
| 16 | 烹饪精通 | 滑块 | ❌ 缺失 | 同上 |
| 17 | 烹饪经验 | 滑块 | ❌ 缺失 | 同上 |
| 18 | 采集精通 | 滑块 | ❌ 缺失 | 同上 |
| 19 | 采集经验 | 滑块 | ❌ 缺失 | 同上 |
| 20 | 钓鱼精通 | 滑块 | ❌ 缺失 | 同上 |
| 21 | 钓鱼经验 | 滑块 | ❌ 缺失 | 同上 |
| 22 | 饮酒精通 | 滑块 | ❌ 缺失 | 同上 |
| 23 | 饮酒经验 | 滑块 | ❌ 缺失 | 同上 |
| 24 | 茶道精通 | 滑块 | ❌ 缺失 | 同上 |
| 25 | 茶道经验 | 滑块 | ❌ 缺失 | 同上 |
| 26 | 口才精通 | 滑块 | ❌ 未规划 | CT有，进度.md遗漏 |
| 27 | 口才经验 | 滑块 | ❌ 未规划 | 同上 |
| 28 | 书法精通 | 滑块 | ❌ 未规划 | CT有，进度.md遗漏 |
| 29 | 书法经验 | 滑块 | ❌ 未规划 | 同上 |

---

#### Tab 4 - 社交 (OthersSlot)

| # | 功能 | 控件类型 | UI状态 | 说明 |
|---|------|----------|--------|------|
| 1 | 送礼必定喜欢 | 开关 | ✅ 已创建 | |
| 2 | 邀请无视条件 | 开关 | ✅ 已创建 | |
| 3 | 切磋无视好感 | 开关 | ✅ 已创建 | |
| 4 | 请教无视要求 | 开关 | ✅ 已创建 | |
| 5 | 切磋获得对手背包 | 开关 | ✅ 已创建 | |
| 6 | NPC装备可脱 | 开关 | ✅ 已创建 | |
| 7 | NPC无视武器功法限制 | 开关 | ✅ 已创建 | |
| 8 | 强制显示NPC互动 | 开关 | ✅ 已创建 | |
| 9 | 物品质量 (送礼) | 下拉框 | ❌ 缺失 | 进度规划有但代码遗漏 |

---

#### Tab 5 - 系统 (GamepadSlot)

| # | 功能 | 控件类型 | UI状态 | 说明 |
|---|------|----------|--------|------|
| 1 | 空格跳跃 | 开关 | ✅ 已创建 | |
| 2 | 　└ 跳跃速度 | 滑块 | ✅ 已创建 | |
| 3 | 　└ 无限跳跃 | 开关 | ✅ 已创建 | |
| 4 | 奔跑/骑马加速 | 开关 | ✅ 已创建 | |
| 5 | 　└ 加速倍率 | 滑块 | ✅ 已创建 | |
| 6 | 坐骑替换 | 开关 | ✅ 已创建 | |
| 7 | 　└ 指定坐骑 | 下拉框 | ✅ 已创建 | 选项: 黑马/白马/棕马/小毛驴 |
| 8 | 一周目可选极难 | 开关 | ✅ 已创建 | |
| 9 | 一周目可选传承 | 开关 | ✅ 已创建 | |
| 10 | 承君传承包括所有 | 开关 | ✅ 已创建 | |
| 11 | 未交互驿站可用 | 开关 | ✅ 已创建 | |
| 12 | 激活GM命令行 | 开关 | ✅ 已创建 | |
| 13 | 解锁全图鉴 | 开关 | ✅ 已创建 | |
| 14 | 解锁全成就 | 开关 | ✅ 已创建 | |
| 15 | 世界移动速度 | 滑块 | ❌ 未规划 | CT有，大地图移动速度 |
| 16 | 场景移动速度 | 滑块 | ❌ 未规划 | CT有，场景内移动速度 |
| 17 | 屏幕设置 | 多项 | ❌ 未规划 | CT有，分辨率/VSync等6子项，复杂度高 |
| 18 | 开档难度系数 | 多项 | ❌ 未规划 | CT有，4难度×14参数，结构复杂 |
| 19 | 称号战力门槛 | 多项 | ❌ 未规划 | CT有，11个称号阈值 |

---

#### Tab 6 - 队友 (动态新增)

| # | 功能 | 控件类型 | UI状态 | 说明 |
|---|------|----------|--------|------|
| 1 | 设置队友跟随数量 | 开关 | ✅ 已创建 | |
| 2 | 　└ 跟随数量 | 滑块 | ✅ 已创建 | |
| 3 | 添加队友 | 下拉框 | ✅ 已创建 | 选项: 百里东风/尚云溪/叶千秋/谢尧/唐婉婉/徐小小/向天笑 |
| 4 | 替换指定队友 | 开关 | ✅ 已创建 | |
| 5 | 　└ 指定队友 | 下拉框 | ✅ 已创建 | 同上角色列表 |

---

#### Tab 7 - 任务 (动态新增)

| # | 功能 | 控件类型 | UI状态 | 说明 |
|---|------|----------|--------|------|
| 1 | 接到/完成任务 | 开关 | ✅ 已创建 | |
| 2 | 　└ 执行类型 | 下拉框 | ✅ 已创建 | 选项: 接到/完成 |

---

#### CT 中存在但暂不实现的功能

| 功能 | 原因 |
|------|------|
| 立绘资源 | 纯数据修改，实用性低 |
| 装备编辑器 (悬停获取+多字段编辑) | 复杂度极高，需自定义 UI |
| 获取当前武学 (编辑器) | CT 用 Lua 动态生成子项 |
| 主角对NPC好感值 (编辑器) | CT 用 Lua 动态生成子项 |
| 获取队伍数据 (编辑器) | CT 用 Lua 动态生成子项 |
| 战斗属性 (战斗中实时) | 需战斗中才能获取，场景限制 |

## 可用 UI 控件类

### 已接入控件

| 类名 | 用途 | 当前状态 | 说明 |
|------|------|----------|------|
| UBPVE_JHConfigVideoItem2_C | 下拉框行 (开关/选项) | 已接入 | TXT_Title, IMG_Icon, CB_Main (UComboBoxString) |
| UBPVE_JHConfigVolumeItem2_C | 滑块行 (数值编辑) | 已接入 | BTN_Minus, BTN_Plus, VolumeSlider, TXT_CurrentValue |
| UBP_JHConfigTabBtn_C | 游戏设置页签按钮 | 已接入 (Tab0-7) | BP_JHConfigTabBtn_classes.hpp |
| UEditableTextBox | 编辑框 (带边框输入框) | 已接入 (物品数量输入) | UMG_classes.hpp |
| UNeoUIButtonBase | NeoUI 按钮底座 | 已接入 (BTN_Exit等) | NeoUI_classes.hpp |

### SDK 可用但未接入控件

| 类名 | 用途 | 说明 |
|------|------|------|
| UNeoUIEditableText | NeoUI 文本输入 (无蓝图包装) | NeoUI_classes.hpp |
| UJHCommon_Btn_Free_C | 游戏通用按钮 (Btn_Revert2 同款) | JHCommon_Btn_Free_classes.hpp |
| UJHGPCBtn_C | 游戏 GPC 按钮基型 | JHGPCBtn_classes.hpp |
| UJHGPCBtn_TXT_C | 带文本的 GPC 按钮 | JHGPCBtn_TXT_classes.hpp |
| UJHGPCBtn_Center_C | 居中样式 GPC 按钮 | JHGPCBtn_Center_classes.hpp |
| UJHGPCBtn_Slot_C | 带 Slot 的 GPC 按钮 | JHGPCBtn_Slot_classes.hpp |
| UJHNeoUIGamepadConfirmButton | 游戏按钮核心父类 | JH_classes.hpp |
| UBPVE_JHConfig_WithLock_C | 带锁行 | BTN_Lock, IMG_Locked, IMG_Unlocked |
| UBPVE_JHConfigLanLine_C | 语言行 | BTN_Minus, BTN_Plus, IMG_Active |
| UVE_JHVideoPanel2_C | 游戏风格折叠面板 (视频设置块) | IsCollapsed, VE_JHVideoPanel2_classes.hpp |
| UVE_JHVolumeAdjustPanel2_C | 游戏风格折叠面板 (音量设置块) | IsCollapsed, VE_JHVolumeAdjustPanel2_classes.hpp |
| UBPMV_Config_LanView2_C | 设置子面板 (含折叠状态) | IsCollapsed, BPMV_Config_LanView2_classes.hpp |
| UBPVE_InputMappingPanel2_C | 键位设置子面板 (可折叠) | IsCollapsed, BPVE_InputMappingPanel2_classes.hpp |
| UJHNeoUIGHC_Region + UBPVE_RegionTitle_C | 区域展开/收起控件 | 标题按钮+内容区, JH_classes.hpp |
| UExpandableArea | UE 原生可展开面板 | 非游戏专属皮肤, UMG_classes.hpp |

### SDK 中不存在的控件
- **CheckBox**: 无 — 用下拉框 "关/开" 代替
- **复杂列表**: 无现成列表控件，物品浏览器已用 UUniformGridPanel + UButton 自行实现

### 控件创建方式
- **UUserWidget子类** (下拉框/滑块/带锁行): `UWidgetBlueprintLibrary::Create(PC, UClass*, PC)` + `Construct()`
- **非UUserWidget** (UVerticalBox等): `StaticConstructObject_Internal` (RVA `0x17C6140`, FStaticConstructObjectParameters 0x40字节)
- **Blueprint UFunction**: 必须通过 `Class->GetFunction("ClassName", "FuncName")` + ProcessEvent，**不要用** `FindFunctionByFName`

## 踩坑记录与技术结论

### 1. SetVisibility 会被蓝图覆盖
- **问题**: 对 `Btn_Revert2`、`TXT_EnterTip` 调用 `SetVisibility(Collapsed)` 后，蓝图事件会重新设回 Visible
- **解决**: 使用 `RemoveFromParent()` 彻底移除，蓝图无法恢复

### 2. 窗口大小无法外部修改
- **尝试过**: `SetDesiredSizeInViewport`、`UCanvasPanelSlot::SetSize`、`SetAnchors`
- **结论**: 蓝图 Widget 有内部布局约束，外部设置无效
- **解决**: 使用 `SetRenderScale(1.1x)` 整体缩放

### 3. EstablishTabBtns 会破坏 Tab 点击
- **问题**: 调用 `EstablishTabBtns` 会重置 `EVT_VisualConstructOnce()` 建立的点击绑定
- **解决**: 不调用 `EstablishTabBtns`，只修改 Tab 文本和图标

### 4. FAnchors 结构体
- **错误**: `FAnchors{ 0.5f, 0.5f, 0.5f, 0.5f }` → C2440
- **原因**: FAnchors 有两个 FVector2D 成员 (Minimum, Maximum)，不是 4 个 float
- **已移除**: 改用 SetRenderScale 后不再需要

### 5. Blueprint UFunction 链接错误 (已修复)
- **错误**: `LNK2001 无法解析的外部符号 Construct()`
- **原因**: `BPVE_JHConfigVideoItem2_functions.cpp` 未加入 vcxproj 编译
- **旧方案** (有BUG): `FindFunctionByFName("Construct")` → 全局遍历 GObjects 找第一个名为 "Construct" 的对象，找到的是**错误的类**的 Construct
- **修复**: 将 `BPVE_JHConfigVideoItem2_functions.cpp` 加入 vcxproj，直接调用 `Item->Construct()` (走 `Class->GetFunction` 精确查找)

### 6. IMG_Title 是图片不是文本
- **问题**: 想把标题从"游戏设置"改成"作弊"，但 IMG_Title 是 UNeoUIImageBase（贴图）
- **解决**: 直接 `SetVisibility(Collapsed)` 隐藏

### 7. TXT_EnterTip 只在战斗 Tab 显示
- **问题**: 提示文字"选中后点击Enter进行修改"只在战斗 Tab 可见，切换 Tab 后消失
- **尝试**: 重新挂载到 VB_Global / CT_TabBtns 均失败
- **解决**: 直接 `RemoveFromParent()` 移除

## 关键文件

| 文件 | 说明 |
|------|------|
| `Inject/Main.cpp` | 主逻辑，DLL入口、Hook、UI创建、Tab填充 |
| `Inject/VTHook.hpp` | VTable Hook 封装 |
| `SDK/BPMV_ConfigView2_classes.hpp` | 设置面板类，所有 Slot/Button/Image 成员 |
| `SDK/JH_classes.hpp` | 游戏 UI 基类，CT_Contents(0x0388)、TXT_Title 等 |
| `SDK/BPVE_JHConfigVideoItem2_classes.hpp` | 下拉框控件 (IMG_Icon, Construct) |
| `SDK/BPVE_JHConfigVolumeItem2_classes.hpp` | 滑块控件 (BTN_Minus, BTN_Plus) |
| `SDK/UMG_classes.hpp` | UE4 UMG 基础类 (UButton, UPanelWidget 等) |
| `SDK/Basic.hpp` | SDK 基础设施 (FName, FindFunctionByFName, StringToName) |

## 已完成功能

- [x] DLL 注入框架 (version.dll 代理)
- [x] GVC PostRender VTable Hook
- [x] HOME 键切换作弊面板显示/隐藏
- [x] DELETE 键安全卸载 DLL
- [x] 劫持 BPMV_ConfigView2_C 作为 UI 基础
- [x] 8 个 Tab (角色/物品/战斗/生活/社交/系统 + 动态新增队友/任务) + 图标隐藏
- [x] 隐藏标题图片 (IMG_Title)
- [x] 移除刷新/重置按钮 (Btn_Revert2)
- [x] 移除提示文字 (TXT_EnterTip)
- [x] 面板 1.1x 缩放
- [x] 打开面板时暂停游戏 (SetGamePaused)
- [x] 关闭按钮 (BTN_Exit) 点击检测 (边沿触发)
- [x] 真实 Widget 可见性检测 (IsInViewport)
- [x] 外部关闭检测 (蓝图逻辑关闭时自动恢复游戏)
- [x] 角色 Tab UI 框架 (6 个下拉框项: 金钱/武学点/经脉点/门派贡献/等级/额外心法栏)
- [x] 滑块控件 (UBPVE_JHConfigVolumeItem2_C) 创建函数 + Construct + functions.cpp 编译
- [x] 完成所有 6 个 Tab 的 UI 填充 (开关/滑块/下拉框)
- [x] GC Root 防回收 (MarkAsGCRoot: RF_MarkAsRootSet=0x80 at UObject+0x08)
- [x] 蓝图委托清除 (ClearDelegate: OnValueChanged/OnClicked/OnSelectionChanged)
- [x] 物品浏览器 UI 框架 (DataTable 遍历 + 图标 + 分页 + 添加)
- [x] 动态新增 Tab 6 (队友) — 按钮创建 + CT_TabBtns 添加 + CT_Contents 内容 + per-frame 点击切换
- [x] 动态新增 Tab 7 (任务) — 同上架构
- [x] 队友 Tab UI 填充 (跟随数量开关/滑块 + 添加队友下拉框 + 替换队友开关/下拉框)
- [x] 任务 Tab UI 填充 (接到/完成任务开关 + 执行类型下拉框)
- [x] 动态 Tab 切换逻辑 (边沿触发 BtnMain->IsPressed + SetActiveWidgetIndex + EVT_UpdateActiveStatus)

## 待完成

### Phase 1.5 - 物品浏览器 (当前)
- [ ] 编译验证物品浏览器 (DataTable 遍历 + SetBrushFromSoftTexture)
- [ ] 验证 per-frame 翻页/分类/添加交互

### Phase 2 - 作弊逻辑（SDK实现）
- [ ] 基于 SDK Manager/FuncLib 实现“开关”类功能 on/off（不走 ASM 注入）
- [ ] 基于 SDK API 实现“数值”类功能读写（角色/物品/战斗等）
- [ ] 建立统一功能状态层（UI 值 <-> SDK 调用）并做开关持久化
- [ ] UI 回调绑定: ComboBox OnSelectionChanged / Slider OnValueChanged
- [ ] 补充失败保护与回滚（对象为空、场景切换、面板关闭）

### Phase 3 - 高级功能
- [x] 动态新增 Tab 6/7 (队友/任务) — UI 框架已完成，待编译验证
- [ ] 添加物品到背包 (ID列表 + 数量)
- [ ] 添加/替换队友 (角色ID列表)
- [ ] 接到/完成任务 (任务ID列表)

### 8. FindFunctionByFName 全局搜索 BUG
- **问题**: `BasicFilesImpleUtils::FindFunctionByFName` 遍历所有 GObjects，返回第一个匹配名称的对象
- **危害**: "Construct" 在 UE4 中非常常见，找到的往往不是目标类的函数
- **结论**: 永远不要用 `FindFunctionByFName` 来查找具体类的函数，应使用 `Class->GetFunction("ClassName", "FuncName")` 或直接调用 SDK 生成的包装函数

### 9. NamedSlot 内容可能为空
- **问题**: `EVT_SetupSubModuleSlots()` 依赖 ViewModel 系统 (`GetOwnerVM_Unsafe`)，独立创建的 Widget 可能没有 VM 绑定
- **现象**: NamedSlot 的 children 为 0，`GetSlotContentBox` 返回 nullptr
- **解决**: 添加 fallback 逻辑，slot 为空时使用 `VB_Global` (父类 UScrollBox/UVerticalBox)
- **注意**: VB_Global fallback 不支持按 Tab 切换内容，后续需找到创建 UVerticalBox 的方法

### 10. WidgetTree 偏移
- **位置**: `UUserWidget::WidgetTree` 在偏移 `0x01D8`
- **类型**: `UWidgetTree*`，其中 `RootWidget` 在 `0x0028`
- **用途**: 后续若需动态创建 UVerticalBox 等非 UUserWidget 的 Widget，需通过 WidgetTree

### 11. UJHCommon_Btn_Free_C 裸放在 HorizontalBox 中只显示文本
- **问题**: `UJHCommon_Btn_Free_C` 是蓝图 UserWidget，内部的 `JHGPCBtn`（真正的可视/可交互按钮）需要父容器提供足够的布局空间。裸放在 `HorizontalBox` 里时，按钮的 DesiredSize 没有正确传播，导致 `JHGPCBtn` 被压缩到零尺寸——只剩下文本 `txt` 能渲染出来（文本不依赖 `JHGPCBtn` 的布局）
- **解决**: `CreateGameStyleButton` 始终用 `USizeBox` 包裹按钮（默认 160×56），通过 `OutLayoutWidget` 输出参数让调用方拿到 SizeBox 添加到容器

### 12. MSVC 中文注释编码问题
- **问题**: Write 工具生成 UTF-8 无 BOM 文件，MSVC 在中文 Windows 上默认按 GBK 解析，中文注释导致 267 个连锁编译错误
- **解决**: 在 vcxproj 的 `<ClCompile>` 中添加 `/utf-8` 编译选项

## 当前阻塞/风险

1. **NamedSlot 为空已解决**: 通过 `StaticConstructObject_Internal` (RVA 0x17C6140) 创建 UVerticalBox 并 AddChild 到 NamedSlot — 待编译验证
2. **动态 Tab 崩溃**: 新创建的 Tab 过一会游戏崩溃，疑似 GC 回收了动态创建的 Widget (UVerticalBox/Tab按钮没有被 GC Root 持有)
3. **崩溃修复方案**: 需给动态创建的 UObject 设置 `RF_MarkAsRootSet` 标志位 (值=0x100) 防止 GC 回收，或将其加入 WidgetTree
4. **CreateTabButton 中的 Construct()**: Blueprint UFunction，启用动态 Tab 时需加入对应 `_functions.cpp`
5. **Phase 2 实现路径**: 统一改为 SDK 函数调用与对象读写，不再依赖 Auto Assembler 内存补丁；需继续补齐各功能对应的 SDK 入口与空指针保护
